---
title: "Draft v2"
format: pdf
editor: visual
---

## 1.0 Introduction

The United Kingdom’s withdrawal from the European Union represents one of the most significant institutional and economic changes in recent decades. The Brexit referendum was held in June 2016, and the UK officially left the European Union (EU) on 31 January 2020, marking the end of nearly five decades of membership. EU has long been the UK’s largest trading partner, Brexit introduced new barriers to trade, altered market access conditions, and reshaped the country’s external economic relationships.

This project aims to analyse how the UK’s trade with EU and non-EU partners has evolved before and after Brexit, with a particular focus on identifying structural shifts in trade intensity. The analysis is grounded in the gravity model of international trade, which provides data for explaining bilateral trade as a function of economic size, distance, and institutional linkages. By examining trade developments between 2010 and 2020, we seek to explore whether Brexit has led to changes in trading patterns

### 1.1 Research question

How has the United Kingdom’s withdrawal from the European Union affected its trade flows with EU and non-EU partners?

The objective is to document changes in the level and composition of UK goods trade before and after Brexit.

## 2.0 Data collection

The dataset draws on the CEPII Gravity Database and contains a targeted selection of bilateral variables between the United Kingdom and its trading partners. When uploading the gravity data set, we downloaded the Gravity documentation file which included information about the variables in the data set. Among all variables, we selected variables that present the main economic, geographic, and institutional factors that may have shaped trade patterns before and after Brexit.

### 2.1 Packages

```{r}
#| label: Packages and global settings
#| message: false
#| warning: false

# For data collection
library(here)

# For data manipulation
library(dplyr)
library(tidyverse)

# For making visualisations
library(ggplot2)
library(patchwork)      # helper package for side-by-side plots
library(scales)         # Scale functions for visualisations

# For report generation
library(knitr)

# Global settings
options(scipen = 999)     #makes R write large numbers without scientific notations
```

### 2.2 Creating the datasets

For this analysis we gathered data from the gravity dataset ... we also gathered data from the World Development Indicators (WDI) from the World Bank.

```{r}
#| label: Creating datasets

# Read the gravity data
gravity <- readRDS(here("data", "Gravity_V202211.rds")) %>% 
  select(
    year, iso3_o, iso3_d, eu_o, eu_d,
    country_exists_o, country_exists_d,
    distcap, pop_o, pop_d, gdp_o, gdp_d,
    tradeflow_comtrade_o, tradeflow_comtrade_d
  ) %>% 
  filter(
    iso3_o == "GBR" | iso3_d == "GBR",
    country_exists_o == 1 | country_exists_d == 1,
    year %in% 2010:2020
  ) %>%                   
  mutate(partner_eu = if_else(iso3_o == "GBR", eu_d, eu_o))

# Read the WDI data
WDI <- read_csv("WDI_NY.GDP.PCAP.KD.csv", col_names = TRUE, skip = 3) %>%
  select(!starts_with("...70"), -"Indicator Code") %>% 
  pivot_longer(
    cols = matches("^(19|20)"),
    names_to = "year",
    values_to = "value"
  ) %>% 
  pivot_wider(
    names_from = "Indicator Name",
    values_from = "value"
  ) %>% 
  rename("GDPpc" = "GDP per capita (constant 2015 US$)") %>% 
  filter(year %in% 2010:2024) %>% 
  mutate(year = as.numeric(year))
```

Based on our main dataset, we also created smaller subsets of data…

```{r}
#| label: Create UK trade subsets

# All UK exports 2010–2020
uk_exports <- gravity %>% 
  select(!starts_with("country_exists")) %>% 
  filter(iso3_o == "GBR")

# All UK imports 2010–2020
uk_imports <- gravity %>% 
  select(!starts_with("country_exists")) %>% 
  filter(iso3_d == "GBR")

# Subsets by year
uk_exports_2010 <- uk_exports %>% filter(year == 2010)
uk_exports_2020 <- uk_exports %>% filter(year == 2020)
```

### 2.3 Variables

(unchanged narrative)

## 3.0 Analysis

(unchanged narrative)

```{r}
#| label: trade-table

trade_partners <- data.frame(
  Country = c(
    "Germany",
    "Netherlands",
    "France",
    "Italy",
    "Spain",
    "Belgium",
    "United States",
    "Switzerland",
    "Canada"
  ),
  `Key trade features` = c(
    "UK’s largest EU trade partner, major machinery and automotive trade.",
    "Logistics hub (Rotterdam effect), re-exports dominate goods flows.",
    "Long-standing partner; key for manufacturing, transport, and defence industries.",
    "High-value goods, industrial machinery, and consumer products.",
    "Growing services and tourism linkages.",
    "Chemicals, pharmaceuticals, and transport equipment.",
    "The UK’s largest single-country trading partner, with strong links in finance, technology, and services.",
    "Significant financial and pharmaceutical trade, with high-value exports and close investment ties.",
    "Expanding trade in energy, technology, and services, supported by the UK–Canada trade continuity agreement."
  )
)

kable(trade_partners, caption = "Overview: Key UK trade relationships by country included in the analysis")
```

```{r}
#| label: fig-uk-gdp
#| fig-cap: "Figure: UK GDP per capita..."
#| fig-align: center

uk_gdp <- WDI %>% 
  filter(`Country Code` == "GBR")

ggplot(uk_gdp, aes(x = year, y = GDPpc )) +
  geom_line(color = "#003399", linewidth = 1.1) +
  geom_vline(xintercept = 2016, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "darkred") +
  labs(
    title = "UK GDP per capita (constant 2015 US$)",
    subtitle = "Dashed lines: 2016 referendum and 2021 Trade and Cooperation Agreement",
    x = "Year",
    y = "GDP per capita (USD, constant 2015)"
  ) +
  theme_minimal(base_size = 13)
```

(Your commentary kept unchanged)

```{r}
#| label: fig-gdp-cumulative
#| fig-cap: "Figure: Cumulative change..."
#| fig-align: center

dat <- WDI %>% 
  filter(`Country Code` %in% c("GBR", "DEU", "FRA", "ITA", "ESP", "NLD", "BEL", "CHN", "CAN")) %>% 
  rename(country = `Country Code`)

dat_growth <- dat %>%
  group_by(country) %>%
  mutate(
    base_2010 = GDPpc[year == 2010],
    pct_change = ((GDPpc / base_2010) - 1) * 100
  ) %>%
  ungroup()

ggplot(dat_growth, aes(x = year, y = pct_change, group = country)) +
  geom_line(aes(color = country), alpha = 0.4, size = 1) +
  geom_line(
    data = filter(dat_growth, country == "GBR"),
    aes(x = year, y = pct_change, color = country),
    size = 1.8
  ) +
  geom_vline(xintercept = 2016, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "darkred") +
  labs(
    title = "Cumulative change in real GDP per capita since 2010",
    subtitle = "Dashed lines: 2016 Brexit referendum and 2021 Trade and Cooperation Agreement",
    x = "Year",
    y = "Percent change since 2010",
    color = "Country"
  ) +
  theme_minimal()
```

### 3.1 UK trade with EU and non-EU partners

```{r}
uk_trade_eu <- gravity %>%
  group_by(year, partner_eu) %>%
  summarise(
    exports = sum(tradeflow_comtrade_o, na.rm = TRUE),
    imports = sum(tradeflow_comtrade_d, na.rm = TRUE),
    .groups = "drop"
  )
```

### 3.2 Plot: UK exports to EU vs non-EU

```{r}
ggplot(uk_trade_eu, aes(x = year, y = exports, color = factor(partner_eu))) +
  geom_line(size = 1.2) +
  geom_vline(xintercept = 2016, linetype = "dashed") +
  geom_vline(xintercept = 2020, linetype = "dashed") +
  labs(
    title = "UK Exports to EU and Non-EU Partners (2010–2020)",
    x = "Year",
    y = "Exports (USD)",
    color = "EU partner"
  ) +
  theme_minimal()
```

### 3.3 Plot: UK imports from EU vs non-EU

```{r}
ggplot(uk_trade_eu, aes(
  x = year, 
  y = imports, 
  color = factor(partner_eu, labels = c("Non-EU", "EU"))
)) +
  geom_line(size = 1.2) +
  geom_vline(xintercept = 2016, linetype = "dashed") +
  geom_vline(xintercept = 2020, linetype = "dashed") +
  labs(
    title = "UK Imports from EU and Non-EU Partners (2010–2020)",
    x = "Year",
    y = "Imports (USD)",
    color = "Partner type"
  ) +
  theme_minimal()
```

### 3.4 EU share of UK trade

```{r}
eu_share <- uk_trade_eu %>%
  group_by(year) %>%
  mutate(
    total_exports = sum(exports),
    total_imports = sum(imports),
    eu_share_exports = exports[partner_eu == 1] / total_exports,
    eu_share_imports = imports[partner_eu == 1] / total_imports,
  ) %>%
  distinct(year, eu_share_exports, eu_share_imports)
```

```{r}
ggplot(eu_share, aes(x = year)) +
  geom_line(aes(y = eu_share_exports, color = "Exports"), size = 1.2) +
  geom_line(aes(y = eu_share_imports, color = "Imports"), size = 1.2) +
  geom_vline(xintercept = 2016, linetype = "dashed") +
  geom_vline(xintercept = 2020, linetype = "dashed") +
  labs(
    title = "EU Share of UK Exports and Imports",
    x = "Year",
    y = "EU share",
    color = "Flow"
  ) +
  theme_minimal()
```

### 3.5 Largest UK export and import flows

```{r}
#| label: Largest UK export and import flows

largest_export <- uk_exports %>%
  filter(!is.na(tradeflow_comtrade_o)) %>%
  slice_max(tradeflow_comtrade_o, n = 1) %>%
  select(year, iso3_d, tradeflow_comtrade_o)

largest_import <- uk_imports %>%
  filter(!is.na(tradeflow_comtrade_d)) %>%
  slice_max(tradeflow_comtrade_d, n = 1) %>%
  select(year, iso3_o, tradeflow_comtrade_d)

kable(largest_export, caption = "Largest UK export flow (2010–2020)")
kable(largest_import, caption = "Largest UK import flow (2010–2020)")

summary(uk_exports$tradeflow_comtrade_o)
```

### 3.6 Regression analysis

```{r}
#| label: Regression analysis-EU vs non-EU trade after 2016

regdata <- gravity %>%
  mutate(
    ln_exports = log(tradeflow_comtrade_o + 1),
    post2016 = if_else(year >= 2016, 1, 0)
  )

model <- lm(ln_exports ~ partner_eu * post2016, data = regdata)

summary(model)
```

## 4.0 Bibliography

Conte, M., Cotterlaz, P., & Mayer, T. (2022). *The CEPII Gravity database.* CEPII Working Paper 2022-05.

World Bank. (2024). *World Development Indicators.* Retrieved from https://data.worldbank.org/source/world-development-indicators
