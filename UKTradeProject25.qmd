---
title: "UKTrade"
format: html
editor: visual
---

**1.0 Introduction**

The United Kingdom’s withdrawal from the European Union represents one of the most significant institutional and economic changes in recent decades. The Brexit referendum was held in June 2016, and the UK officially left the EU at 23:00 GMT on 31 January 2020, marking the end of nearly five decades of membership. As the EU has long been the UK’s largest trading partner, Brexit introduced new barriers to trade, altered market access conditions, and reshaped the country’s external economic relationships.

This project aims to analyse how the UK’s trade with EU and non-EU partners has evolved before and after Brexit, with a particular focus on identifying structural shifts in trade intensity. The analysis is grounded in the gravity model of international trade, which provides data for explaining bilateral trade as a function of economic size, distance, and institutional linkages. By examining trade developments between 2010 and 2021\*, we seek to explore whether Brexit has led to changes in trading patterns


**1.1 Research question**

The main research question guiding this project is:

*"How has the United Kingdom’s withdrawal from the European Union affected its trade flows with EU and non-EU partners?*"

The objective is to examine changes in the volume and composition of UK trade before and after Brexit, providing insight into how this institutional shift has influenced the country’s trading relationships.\


**2.0 Data collection**

The dataset draws on the CEPII Gravity Database and contains a targeted selection of bilateral variables between the United Kingdom and its trading partners. When uploading the gravity data set, we downloaded the Gravity documentation file which included information about the variables in the data set. Among all variables, we selected variables that present the main economic, geographic, and institutional factors that may have shaped trade patterns before and after Brexit.


**2.1 Packages**

```{r}
# For data manipulation
library(dplyr)
library(tidyverse)

# For making visualisations
library(ggplot2)
library(patchwork)      # helper package for side-by-side plots
library(scales)         # Scale functions for visualisations

# For report generation
library(knitr)

# For access to World Development Indicators from the World Bank
library(WDI)
```


**2.2 Creating the datasets**

For this analysis we gathered data from the gravity dataset ... we also used data from World Development Indicators provided by the World bank ...

```{r}
# Read the gravity data
gravity <- readRDS("data/Gravity_V202211.rds") %>% # Gravity source file location
  select(
    year, iso3_o, iso3_d, eu_o, eu_d,
    country_exists_o, country_exists_d,
    distcap, pop_o, pop_d, gdp_o, gdp_d,
    tradeflow_comtrade_o, tradeflow_comtrade_d
  ) %>% 
  filter(
    iso3_o == "GBR" | iso3_d == "GBR",        # only include observations with the UK
    country_exists_o == 1 | country_exists_d == 1,  # remove observations with non-existing countries
    year %in% 2010:2020                       # focus on 2010–2020
  )

# Data from the World Bank is imported via the WDI package
```

FBased on our main dataset, we also created smaller subsets of data ... among them, seperate datasets containing UK exports and UK imports ...

```{r}
#| label: Create UK trade subsets

# All UK exports 2010–2020
uk_exports <- gravity %>% 
  select(!starts_with("country_exists")) %>% 
  filter(iso3_o == "GBR")

# All UK imports 2010–2020
uk_imports <- gravity %>% 
  select(!starts_with("country_exists")) %>% 
  filter(iso3_d == "GBR")

# Subsets by year
uk_exports_2010 <- uk_exports %>% filter(year == 2010)
uk_exports_2020 <- uk_exports %>% filter(year == 2020)
```



**2.1 Variables**

The trade flow variables (`tradeflow_comtrade_o`, `tradeflow_comtrade_d`) capture the value of exports and imports in current USD, forming the foundation for analysing how trade volumes evolved over time. To control for differences in market size and economic capacity, the dataset includes GDP (`gdp_o`, `gdp_d)` and population (`pop_o`, `pop_d`) for both the UK and its partners, providing context for the scale and potential intensity of bilateral trade. Geographic distance (`distcap`) serves as a proxy for trade costs, reflecting how physical separation can constrain trade through higher transport and transaction costs. The EU membership indicators (`eu_o`, `eu_d`) are central to the analysis, as they allow a distinction between EU and non-EU trading partners and thereby facilitate the identification of changes linked to the UK’s withdrawal from the EU. Finally, the country existence variables ensure that only valid and contemporaneous country pairs are included each year. In total, these core variables were selected from the broader CEPII database to provide a balanced representation of economic scale, spatial frictions, and institutional context, enabling a systematic analysis of how the UK’s trade flows may have been affected by Brexit.

**3.0 Analysis:**

Countries were chosen because they are among the UK’s trade partners, and they are all included in standard gravity datasets such as CEPII and UN Comtrade. They represent both nearby European economies and major global markets. Most have long-standing trade or historical ties with the UK, making them suitable for comparative analysis. Their inclusion ensures that it is possible to analyse bilateral trade composition and flows within a consistent gravity-model framework.

```{r}
#| label: trade-table
#| echo: false
#| message: false
#| warning: false

# Table showing UK trading partners
trade_partners <- data.frame(
  Country = c(
    "Germany",
    "Netherlands",
    "France",
    "Italy",
    "Spain",
    "Belgium",
    "United States",
    "Switzerland",
    "Canada"
  ),
  `Key trade features` = c(
    "UK’s largest EU trade partner, major machinery and automotive trade.",
    "Logistics hub (Rotterdam effect), re-exports dominate goods flows.",
    "Long-standing partner; key for manufacturing, transport, and defence industries.",
    "High-value goods, industrial machinery, and consumer products.",
    "Growing services and tourism linkages.",
    "Chemicals, pharmaceuticals, and transport equipment.",
    "The UK’s largest single-country trading partner, with strong links in finance, technology, and services.",
    "Significant financial and pharmaceutical trade, with high-value exports and close investment ties.",
    "Expanding trade in energy, technology, and services, supported by the UK–Canada trade continuity agreement."
  )
)

kable(trade_partners, caption = "Overview: Key UK trade relationships by country included in the analysis")
```



**TEMPORARY PARKING SPACE FOR CODE CHUNKS**

```{r}
#| label: fig-uk-gdp
#| fig-cap: "Figure: UK GDP per capita (constant 2015 US$)"
#| fig-align: center

# Get GDPpc indicator from WDI (World Bank)
uk_gdp <- WDI(
  country = "GB",                 # GB is the UK code in WDI
  indicator = "NY.GDP.PCAP.KD",   # GDP percapita (constant 2015 US$)
  start = 2000,
  end = 2022
)

# Plot UK GDPpc line graph
ggplot(uk_gdp, aes(x = year, y = NY.GDP.PCAP.KD)) +
  geom_line(color = "#003399", linewidth = 1.1) +
  geom_vline(xintercept = 2016, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "darkred") +
  labs(
    title = "UK GDP per capita (constant 2015 US$)",
    subtitle = "Dashed lines: 2016 Brexit referendum and 2021 Trade and Cooperation Agreement",
    x = "Year",
    y = "GDP per capita (USD, constant 2015)"
  ) +
  theme_minimal(base_size = 13)
```




```{r}
#| label: fig-gdp-cumulative
#| fig-cap: "Figure: Cumulative change in real GDP per capita since 2010."
#| fig-align: center
#| message: false
#| warning: false


# Download GDP per capita (constant 2015 USD) for selected countries
dat <- WDI(
  country = c("GB", "DE", "FR", "IT", "ES", "NL", "BE", "CH", "CA"),
  indicator = "NY.GDP.PCAP.KD",
  start = 2010,
  end = 2024
)

# Calculate cumulative percent change since 2010
dat_growth <- dat %>%
  group_by(country) %>%
  mutate(
    base_2010 = NY.GDP.PCAP.KD[year == 2010],
    pct_change = ((NY.GDP.PCAP.KD / base_2010) - 1) * 100
  ) %>%
  ungroup()

# Plot with bold UK line
ggplot(dat_growth, aes(x = year, y = pct_change, group = country)) +
  geom_line(aes(color = country), alpha = 0.4, size = 1) +
  geom_line(
    data = filter(dat_growth, country == "United Kingdom"),
    aes(x = year, y = pct_change, color = country),
    size = 1.8
  ) +
  geom_vline(xintercept = 2016, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "darkred") +
  labs(
    title = "Cumulative change in real GDP per capita since 2010",
    subtitle = "Dashed lines: 2016 Brexit referendum and 2021 Trade and Cooperation Agreement",
    x = "Year",
    y = "Percent change since 2010",
    color = "Country",
    caption = "Source: World Bank, World Development Indicators (accessed 2025-11-01)"
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold"),
    plot.caption = element_text(hjust = 0.5, size = 10)
  )
```


To make the UK line appear bolder in the figure, the code first plots all countries using geom line () with lower opacity, alpha (0,4) and a moderate size. Then, added a second geom line layer that specifically filters the data for the United Kingdom (data = filter(dat_growth, country == "United Kingdom"), and plots it again with a thicker line, for a contrast effect.

------------------------------------------------------------------------


### Main trading partners

```{r}
#| label: Top 10 UK export destinations in 2010

# Top 10 UK export destinations in 2010
uk_exports_2010 %>% 
  select(year, starts_with(c("iso3", "eu")), tradeflow_comtrade_o) %>% 
  arrange(desc(tradeflow_comtrade_o)) %>% 
  slice(1:10)

```

```{r}
#| label: Top 10 UK export destinations in 2020

# Top 10 UK export destinations in 2020
uk_exports_2020 %>% 
  select(year, starts_with(c("iso3", "eu")), tradeflow_comtrade_o) %>% 
  arrange(desc(tradeflow_comtrade_o)) %>% 
  slice(1:10)

```

## EU vs Non-EU comparison ----

## Usikker på om denne funker
```{r}

# Drop missing values to avoid warnings
uk_exports_2010_clean <- uk_exports_2010 %>% drop_na(tradeflow_comtrade_o)
uk_exports_2020_clean <- uk_exports_2020 %>% drop_na(tradeflow_comtrade_o)

# Create both plots separately
plot_2010 <- ggplot(uk_exports_2010_clean, aes(x = factor(eu_d), y = tradeflow_comtrade_o)) +
  geom_jitter(width = 0.1, alpha = 0.7, color = "steelblue") +
  labs(
    title = "UK Exports to EU vs Non-EU Countries (2010)",
    x = "EU Membership (Destination)",
    y = "Export Value"
  ) +
  theme_minimal()

plot_2020 <- ggplot(uk_exports_2020_clean, aes(x = factor(eu_d), y = tradeflow_comtrade_o)) +
  geom_jitter(width = 0.1, alpha = 0.7, color = "darkred") +
  labs(
    title = "UK Exports to EU vs Non-EU Countries (2020)",
    x = "EU Membership (Destination)",
    y = "Export Value"
  ) +
  theme_minimal()

# Display side by side
plot_2010 + plot_2020
```


```{r}
#| label: EU vs Non-EU tradeflows (2010 vs 2020)

uk_exports %>% 
  filter(year %in% c(2010, 2020)) %>% 
  group_by(year, eu_d) %>% 
  summarise(total_trade = sum(tradeflow_comtrade_o, na.rm = TRUE)) %>% 
  ggplot(aes(x = factor(year), y = total_trade, fill = factor(eu_d))) +
  geom_col(position = "dodge") +
  labs(
    title = "Total UK Exports: EU vs Non-EU (2010 vs 2020)",
    x = "Year",
    y = "Total Export Value",
    fill = "EU Membership"
  )
```
