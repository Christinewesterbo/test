---
title: "Draft v4"
author: "Christine Westerbø and Kamilla Aaboen"
format: pdf
editor: visual
---

## 1.0 Introduction

The United Kingdom’s withdrawal from the European Union represents one of the most significant institutional and economic changes in recent decades. The Brexit referendum was held in June 2016, and the UK officially left the European Union (EU) on 31 January 2020, marking the end of nearly five decades of membership. EU has long been the UK’s largest trading partner, Brexit introduced new barriers to trade, altered market access conditions, and reshaped the country’s external economic relationships.

This project aims to analyse how the UK’s trade with EU and non-EU partners has evolved before and after the Brexit referendum, with a particular focus on identifying structural shifts in trade intensity. The analysis is grounded in the gravity model of international trade, which provides data for explaining bilateral trade as a function of economic size, distance, and institutional linkages. By examining trade developments between 2010 and 2020, we seek to explore whether Brexit has led to changes in trading patterns

### 1.1 Research question

*How has the United Kingdom's trading patterns with EU and non-EU partners changed since the Brexit referendum in 2016?*

(Gammel: *How has the United Kingdom’s withdrawal from the European Union affected its trade flows with EU and non-EU partners?*) (The objective is to document changes in the level and composition of UK goods trade before and after Brexit.)

## 2.0 Data and methods

The dataset draws on the CEPII Gravity Database and contains a targeted selection of bilateral variables between the United Kingdom and its trading partners. When uploading the gravity data set, we downloaded the Gravity documentation file which included information about the variables in the data set. Among all variables, we selected variables that present the main economic, geographic, and institutional factors that may have shaped trade patterns before and after Brexit.

### 2.1 Packages

```{r}
#| label: Packages and global settings
#| message: false
#| warning: false

# For data collection
library(here)

# For data manipulation
library(dplyr)
library(tidyverse)
library(countrycode)

# For making visualisations
library(ggplot2)
library(patchwork)      # helper package for side-by-side plots
library(scales)         # Scale functions for visualisations

# For report generation
library(knitr)

# Global settings
options(scipen = 999)     #makes R write large numbers without scientific notations
```

### 2.2 Creating the datasets

For this analysis we gathered data from the gravity dataset ... we also gathered data from the World Development Indicators (WDI) from the World Bank.

```{r}
#| label: Creating datasets

# Read the gravity data
gravity <- readRDS(here("data", "Gravity_V202211.rds")) %>% # Gravity source file location
  select(
    year, iso3_o, iso3_d, eu_o, eu_d,
    country_exists_o, country_exists_d,
    distcap, pop_o, pop_d, gdp_o, gdp_d,
    tradeflow_comtrade_o, tradeflow_comtrade_d
  ) %>% 
  filter(
    iso3_o == "GBR" | iso3_d == "GBR",        # only include observations with the UK
    country_exists_o == 1 & country_exists_d == 1,  # remove observations with non-existing countries
    year %in% 2010:2020) %>%                   # focus on 2010–2020
  mutate(partner_eu = if_else(iso3_o == "GBR", eu_d, eu_o)) %>% # EU-status for partnerland
  mutate(country_d = countrycode(iso3_d, "iso3c", "country.name", nomatch = NULL),
         country_o = countrycode(iso3_o, "iso3c", "country.name", nomatch = NULL)) #ANT should be the only nomatch. Was dissolved in 2010

# Read the WDI data
WDI <- read_csv("WDI_NY.GDP.PCAP.KD.csv", col_names = TRUE, skip = 3) %>%
  select(!starts_with("...70"), # AI disclaimer (mystery column)
         -"Indicator Code") %>% 
  pivot_longer(
    cols = matches("^(19|20)"), # AI disclaimer, regex?
    names_to = "year",
    values_to = "value"
  ) %>% 
  pivot_wider( # AI disclaimer: explained the documentation
    names_from = "Indicator Name",
    values_from = "value"
  ) %>% 
  rename("GDPpc" = "GDP per capita (constant 2015 US$)") %>% 
  filter(year %in% 2010:2024) %>% 
  mutate(year = as.numeric(year))
```

Based on our main dataset, we also created smaller subsets of data ... among them, seperate datasets containing UK exports and UK imports ...

```{r}
#| label: Create UK trade subsets

# All UK exports 2010–2020
uk_exports <- gravity %>% 
  select(!starts_with("country_exists")) %>% 
  filter(iso3_o == "GBR")

# All UK imports 2010–2020
uk_imports <- gravity %>% 
  select(!starts_with("country_exists")) %>% 
  filter(iso3_d == "GBR")

# Subsets by year
uk_exports_2010 <- uk_exports %>% filter(year == 2010)
uk_exports_2020 <- uk_exports %>% filter(year == 2020)
```

### 2.3 Variables

The trade flow variables (tradeflow_comtrade_o, tradeflow_comtrade_d) capture the value of exports and imports in current USD, forming the foundation for analysing how trade volumes evolved over time. To control for differences in market size and economic capacity, the dataset includes GDP (gdp_o, gdp_d) and population (pop_o, pop_d) for both the UK and its partners, providing context for the scale and potential intensity of bilateral trade. Geographic distance (distcap) serves as a proxy for trade costs, reflecting how physical separation can constrain trade through higher transport and transaction costs. The EU membership indicators (eu_o, eu_d) are central to the analysis, as they allow a distinction between EU and non-EU trading partners and thereby facilitate the identification of changes linked to the UK’s withdrawal from the EU. Finally, the country existence variables ensure that only valid and contemporaneous country pairs are included each year. In total, these core variables were selected from the broader CEPII database to provide a balanced representation of economic scale, spatial frictions, and institutional context, enabling a systematic analysis of how the UK’s trade flows may have been affected by Brexit.

## 3.0 Data analysis

To answer the research question this section will firstly explore the data descriptively. A descriptive analysis of the data is useful because it can provide a better understanding of the data.
- UK stats (GDPpc developments, top partners 2010 vs 2020) 
- EU vs. non-EU broadly 
- selected partners

Next, it will present some statistical models to better understand the data 
- regression analyses

### 3.1 Descriptive data analysis

#### 3.1.1 The United Kindom

```{r}
#| label: fig-uk-gdp
#| fig-cap: "UK GDP per capita (constant 2015 US$), with 2016 referendum and 2021 Trade and Cooperation Agreement marked by dashed lines."
#| fig-align: center

# Get UK GDP per capita (constant 2015 USD)
uk_gdp <- WDI %>% 
  filter(`Country Code` == "GBR")

# Plot
ggplot(uk_gdp, aes(x = year, y = GDPpc )) +
  geom_line(color = "#003399", linewidth = 1.1) +
  geom_vline(xintercept = 2016, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "darkred") +
  labs(
    title = "UK GDP per capita (constant 2015 US$)",
    subtitle = "Dashed lines: 2016 Brexit referendum and 2021 Trade and Cooperation Agreement",
    x = "Year",
    y = "GDP per capita (USD, constant 2015)"
  ) +
  theme_minimal(base_size = 13)
```

The figure shows the evolution of UK real GDP per capita (constant 2015 USD) from 2000 to the present. The dashed vertical lines mark two key Brexit-related events: the 2016 referendum and the 2021 Trade and Cooperation Agreement (TCA). On its own, the UK series gives a sense of the country’s long-run income trajectory, but it does not tell us whether Brexit had an effect, because we cannot see how the UK would have evolved in the absence of these shocks. For that, we need a comparison group.

**Main trading partners**

Other descriptive statistic are the UK's main trading partners in 2010 compared to 2020.

```{r}
#| label: Main trading partners 2010 and 2020

# Top 10 UK export observations in 2010
uk_exports_2010 %>% 
  arrange(desc(tradeflow_comtrade_o)) %>% 
  slice(1:10) %>% 
  select("Partner country" = iso3_d,
         "EU member" = eu_d,
         "UK exports" = tradeflow_comtrade_o) %>% 
  kable(caption = "Top 10 UK export observations in 2010")

# Top 10 UK export observations in 2020
uk_exports_2020 %>% 
  arrange(desc(tradeflow_comtrade_o)) %>% 
  slice(1:10) %>% 
  select("Partner country" = iso3_d,
         "EU member" = eu_d,
         "UK exports" = tradeflow_comtrade_o) %>% 
  kable(caption = "Top 10 UK export observations in 2020")

```

From these tables, one can observe that the main destinations for UK exports did not shift notably away from EU members between 2010 and 2020.

**Largest UK export and import flows**

```{r}
#| label: Largest UK export and import flows (2010–2020)

largest_export <- uk_exports %>%
  filter(!is.na(tradeflow_comtrade_o)) %>%
  slice_max(tradeflow_comtrade_o, n = 1) %>%
  select(year, iso3_d, tradeflow_comtrade_o)

largest_import <- uk_imports %>%
  filter(!is.na(tradeflow_comtrade_d)) %>%
  slice_max(tradeflow_comtrade_d, n = 1) %>%
  select(year, iso3_o, tradeflow_comtrade_d)

kable(largest_export, caption = "Largest UK export flow (2010–2020)")
kable(largest_import, caption = "Largest UK import flow (2010–2020)")

summary(uk_exports$tradeflow_comtrade_o)
```

#### 3.1.2 EU and non-EU trading partners

**UK trade with EU and non-EU partners**

```{r}
uk_trade_eu <- gravity %>%
  group_by(year, partner_eu) %>%
  summarise(exports = sum(tradeflow_comtrade_o, na.rm = TRUE),
            imports = sum(tradeflow_comtrade_d, na.rm = TRUE),
            .groups = "drop")

```

**Plot: UK exports to EU vs non-EU**

```{r}
ggplot(uk_trade_eu, aes(x = year, y = exports, color = factor(partner_eu))) +
  geom_line(size = 1.2) +
  geom_vline(xintercept = 2016, linetype = "dashed") +
  geom_vline(xintercept = 2020, linetype = "dashed") +
  labs(title = "UK Exports to EU and Non-EU Partners (2010–2020)",
       x = "Year",
       y = "Exports (USD)",
       color = "EU partner") +
  scale_y_continuous(labels = scales::label_number()) +
  theme_minimal()
```

**Plot: UK imports from EU vs non-EU**

```{r}
#| label: plot-UK imports from EU vs non-EU

ggplot(uk_trade_eu, aes(x = year, y = imports, color = factor(partner_eu, labels = c("Non-EU", "EU"))
)) +
  geom_line(size = 1.2) +
  geom_vline(xintercept = 2016, linetype = "dashed") +
  geom_vline(xintercept = 2020, linetype = "dashed") +
  labs(
    title = "UK Imports from EU and Non-EU Partners (2010–2020)",
    x = "Year",
    y = "Imports (USD)",
    color = "Partner type"
  ) +
  scale_y_continuous(labels = scales::label_number()) +
  theme_minimal()
```

The figure compares the UK’s imports from EU and non-EU partners between 2010 and 2020. Imports from EU partners are consistently higher than imports from non-EU countries throughout the period, reflecting the UK’s strong integration with the EU single market before Brexit. Both series show a dip around 2020 due to the COVID shock. There is no immediate visible drop following the 2016 referendum, but the flat or slightly declining trend after 2016 suggests that import growth from EU partners slowed relative to the pre-Brexit period.

**EU share of UK trade**

```{r}
# Had AI rewrite this code as the previous version gave duplicate NAs that in turn made one of the graphs not functional
eu_share <- uk_trade_eu %>%
  group_by(year) %>%
  summarise(
    total_exports = sum(exports, na.rm = TRUE),
    total_imports = sum(imports, na.rm = TRUE),
    eu_exports = sum(exports[partner_eu == 1], na.rm = TRUE),
    eu_imports = sum(imports[partner_eu == 1], na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    eu_share_exports = eu_exports / total_exports,
    eu_share_imports = eu_imports / total_imports
  ) %>%
  select(year, eu_share_exports, eu_share_imports)
```

**Plot: EU Shares**

```{r}
ggplot(eu_share, aes(x = year)) +
  geom_line(aes(y = eu_share_exports, color = "Exports"), size = 1.2) +
  geom_line(aes(y = eu_share_imports, color = "Imports"), size = 1.2) +
  geom_vline(xintercept = 2016, linetype = "dashed") +
  geom_vline(xintercept = 2020, linetype = "dashed") +
  scale_y_continuous(labels = percent_format()) +
  labs(title = "EU Share of UK Exports and Imports",
       x = "Year",
       y = "EU share",
       color = "Flow"
       ) +
  theme_minimal()
```

The figure shows that the EU’s share of UK exports and imports gradually declines after the 2016 referendum, with a sharper drop around 2020. This indicates that the UK becomes less dependent on EU trade over time, especially following the formal exit from the EU.

#### 3.1.3 Selected partners

Countries were chosen because they are among the UK’s trade partners, and they are all included in standard gravity datasets such as CEPII and UN Comtrade. They represent both nearby European economies and major global markets. Most have long-standing trade or historical ties with the UK, making them suitable for comparative analysis. Their inclusion ensures that it is possible to analyse bilateral trade composition and flows within a consistent gravity-model framework.

```{r}
#| label: trade-table

trade_partners <- data.frame(
  Country = c(
    "Germany",
    "Netherlands",
    "France",
    "Italy",
    "Spain",
    "Belgium",
    "United States",
    "Switzerland",
    "Canada"
  ),
  `Key trade features` = c(
    "UK’s largest EU trade partner, major machinery and automotive trade.",
    "Logistics hub (Rotterdam effect), re-exports dominate goods flows.",
    "Long-standing partner; key for manufacturing, transport, and defence industries.",
    "High-value goods, industrial machinery, and consumer products.",
    "Growing services and tourism linkages.",
    "Chemicals, pharmaceuticals, and transport equipment.",
    "The UK’s largest single-country trading partner, with strong links in finance, technology, and services.",
    "Significant financial and pharmaceutical trade, with high-value exports and close investment ties.",
    "Expanding trade in energy, technology, and services, supported by the UK–Canada trade continuity agreement."
  )
)

kable(trade_partners, caption = "Overview: Key UK trade relationships by country included in the analysis")
```

The second figure therefore plots the cumulative change in real GDP per capita since 2010 for a set of advanced economies: Belgium, Canada, France, Germany, Italy, the Netherlands, Spain, Switzerland, and the UK. Using 2010 as a common baseline highlights how the UK’s growth path compares with peers over the same period. The same dashed lines indicate the 2016 referendum and the 2021 TCA.

```{r}
#| label: fig-gdp-cumulative
#| fig-cap: "Figure: Cumulative change in real GDP per capita since 2010. Dashed lines mark the 2016 Brexit referendum and 2021 Trade and Cooperation Agreement."
#| fig-align: center

# Get GDP per capita (constant 2015 USD) for selected countries
dat <- WDI %>% 
  filter(`Country Code` %in% c("GBR", "DEU", "FRA", "ITA", "ESP", "NLD", "BEL", "CHE", "CAN")) %>% 
  rename(country = `Country Code`)

# Calculate cumulative percent change since 2010
dat_growth <- dat %>%
  group_by(country) %>%
  mutate(
    base_2010 = GDPpc[year == 2010],
    pct_change = ((GDPpc / base_2010) - 1) * 100
  ) %>%
  ungroup()

# Plot with bold UK line
ggplot(dat_growth, aes(x = year, y = pct_change, group = country)) +
  geom_line(aes(color = country), alpha = 0.4, size = 1) +
  geom_line(
    data = filter(dat_growth, country == "United Kingdom"),
    aes(x = year, y = pct_change, color = country),
    size = 1.8
  ) +
  geom_vline(xintercept = 2016, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "darkred") +
  labs(
    title = "Cumulative change in real GDP per capita since 2010",
    subtitle = "Dashed lines: 2016 Brexit referendum and 2021 Trade and Cooperation Agreement",
    x = "Year",
    y = "Percent change since 2010",
    color = "Country",
    caption = "Source: World Bank, World Development Indicators (accessed 2025-11-01)"
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold"),
    plot.caption = element_text(hjust = 0.5, size = 10)
  )

```

To make the UK line appear bolder in the figure, the code first plots all countries using geom line () with lower opacity, alpha (0,4) and a moderate size. Then, added a second geom line layer that specifically filters the data for the United Kingdom (data = filter(dat_growth, country == "United Kingdom"), and plots it again with a thicker line, for a contrast effect.

From this comparative view, it becomes easier to evaluate relative performance. We can see whether the UK’s cumulative growth accelerates or decelerates around the Brexit milestones compared with countries that were not directly exposed to Brexit-related trade shocks. While all countries experience a sharp dip around 2020 due to the COVID-19 pandemic.

The row represents the single largest UK import flow in your dataset between 2010 and 2020. The variable iso3_o shows the origin country (DEU, meaning Germany) and iso3_d shows the destination country (GBR, the United Kingdom). The year variable indicates when this trade flow occurred. The import value itself is recorded in tradeflow_comtrade_d, which is the Comtrade-reported trade flow from Germany to the UK in that specific year. The variables pop_o and pop_d give the populations of the origin and destination countries, while gdp_o and gdp_d refer to their GDP levels. The variable distcap represents the distance between the countries’ capital cities, and eu_o and eu_d indicate whether the origin and destination countries were members of the EU. All of these variables together describe the economic and geographic context of this specific trade flow, allowing you to analyse not only its value but also the conditions under which it occurred.

### 3.2 Data modelling (regression analyses)

The first table shows which country the UK exported the most to in any single year between 2010 and 2020, and the size of that export flow. The second table shows the country from which the UK imported the most in any single year over the same period. These peak flows highlight the UK’s strongest bilateral trade relationships, typically reflecting major EU partners such as Germany or the Netherlands for imports, and large markets like the United States or Germany for exports

```{r}
#| label: Regression analysis-EU vs non-EU trade after 2016

# Prepare data
regdata <- gravity %>%
  mutate(
    ln_exports = log(tradeflow_comtrade_o + 1),
    post2016 = if_else(year >= 2016, 1, 0)
  )

# Run model
model <- lm(ln_exports ~ partner_eu * post2016, data = regdata)

# Show regression results in the knitted report
summary(model)
```

## 4.0 Limitations and conclusion

As part of this project we have looked at ... 
The analysis have shown ... 
The limitations of the analysis are ... (pandemic effect on world economy, the analysis don't cover development after actual brexit, and a word on causality)

## 5.0 Bibliography

Conte, M., P. Cotterlaz and T. Mayer (2022), "The CEPII Gravity database". CEPII Working Paper N°2022-05, July 2022.

World Bank. (2024). World Development Indicators. Retrieved from <https://data.worldbank.org/source/world-development-indicators>
